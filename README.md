# yun-pay-rsa
云账户综合服务平台api调用相关封装
### 本包主要调用方式分为两种
>1.传入参数对象调用服务
```
require_once __DIR__ . '/bootstrap.php';

/**
 * 下单
 * 不同平台不同 data
 * 自行查阅 WGCYunPay\Data\Pay 相关data类
 */
$AliPayData = new \WGCYunPay\Data\Pay\AliPayData();
$AliPayData->order_id   = '20207187466';
$AliPayData->real_name  = '张三';
$AliPayData->id_card    = '500781598308210373';
$AliPayData->pay        = '1.00';
$AliPayData->notes      = '这只是一个测试';
$AliPayData->pay_remark = '这只是一个打款备注';
$AliPayData->card_no    = 'test@126.com';

$GoPay = new \WGCYunPay\Service\PayService($config, $AliPayData);
$res   = $GoPay->query();
var_dump($res);

```
>2.链式操作调用
```
require_once __DIR__ . '/bootstrap.php';

//var_dump($config);
// 查询订单
$order = new \WGCYunPay\Service\OrderService($config);
$res   = $order
       ->setOrderId('2019002156137016ss3971231341211')
       ->setChannel('支付宝')
       ->query();
var_dump($res);
```
####
>具体看tests目录的例子  

>pay.php   打款接口  
>> 1）银⾏卡实时下单  
>> 2）⽀付宝实时下单  
>> 3）企业付款⾄⽤户微信零钱实时下单  
>> 4）查询⼀个订单  
>> 5）回调消息通知  
注意：
云账户异步回调商户状态，提现订单的具体打款结果可根据回调信息中的状态字段(status)进行判断，详细状态描述如下：   

|	提现渠道 |	成功    	|	失败     	|	挂单    	|	退汇    	|	取消    	|
| 	 ----- 	|	 ------ 	|	 ------ 	|	 ------ 	|	 -------	|	 ------ 	|
|	        | (status: 1)   | (status: 2)   | (status: 4)   |	(status: 9)	| (status: 15)  |
|	银行卡	|	中间态	    |	终态    	|	中间态	    |	终态    	|	终态    	|
|	支付宝	|	终态     	|	终态    	|	中间态   	|	×       	|	终态    	|
|	微信	|	终态     	|	终态    	|	中间态   	|	×        	|	终态    	|   

关于订单状态重点说明：  

    银行卡提现时成功为中间态。银行卡提现时可能会存在银行退汇的情况，退汇会造成银行卡提现状态由成功变为退汇失败；     
    订单挂起为中间态。挂单表示当前订单打款条件不满足，订单暂停处理。造成挂单的原因有多种，例如账户余额不足、用户未签约、董高监打款拦截等；     
    订单退汇为终态。只有银行卡提现时可能会出现，这种情况订单会响应两次回调，一次为成功回调，一次为退汇回调，两次回调的时间间隔一般会大于24小时；        
    订单取消为终态。只有挂起的订单可以取消，取消订单之后会发送该回调。   
>> 6）查询商户余额  
>> 7）查询电⼦回单  
>> 8）取消待打款订单  
============================================  
>data.php     数据接口  
>> 1）查询⽇订单⽂件  
>> 2）查询⽇流⽔⽂件  
>> 3）查询商户充值记录  
>> 4）查询⽇订单数据  
>> 5）查询⽇订单⽂件 (打款和退款订单)  
============================================  
>verify.php   用户信息验证  
>> 1.1）银⾏卡四要素请求鉴权（下发短信验证码）  
>> 1.2）银⾏卡四要素确认鉴权（上传短信验证码）  
>> 2）银⾏卡四要素验证  
>> 3）银⾏卡三要素验证  
>> 4）身份证实名验证  
>> 5）上传⽤户免验证名单信息  
>> 6）查看⽤户免验证名单是否存在  
>> 7）银⾏卡信息查询接⼝  
=============================================  
>invoice.php   发票接口  
>> 1）查询商户已开具发票⾦额和待开具发票⾦额  
>> 2）查询可开票额度  
>> 3）开票申请  
>> 4）查询开票申请状态  
>> 5）开票完成通知  
>> 6）下载发票PDF  
=============================================  
>tax.php    个税扣缴  
>> 1）下载个税扣缴明细表  
=============================================  
>h5sign.php  H5用户签约  
>> 1）H5预申请签约接⼝  
>> 2）H5签约接⼝  
>> 3）获取⽤户签约状态  
>> 4）H5对接测试解约接⼝  
>> 5）H5签约回调  
=============================================  
>aic.php   个体工商户注册  
>> 2） ⼯商实名信息录⼊接⼝  
>> 3） 预启动接⼝  
>> 4） 查询个体⼯商户注册状态接⼝  
>> 5） 个体⼯商户注册结果回调详情  
 